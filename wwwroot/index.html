<!DOCTYPE html>
<html>
<head>
    <title>Termine der Feuerwehr Bad S&auml;ckingen</title>
    <script src="./scheduler/dhtmlxscheduler.js" type="text/javascript"></script>
    <script src="./scheduler/locale/locale_de.js" charset="utf-8"></script>
    <script src="./scheduler/ext/dhtmlxscheduler_tooltip.js"></script>
    <script src="./scheduler/ext/dhtmlxscheduler_key_nav.js"></script>
    <link rel="stylesheet" href="./scheduler/dhtmlxscheduler.css" type="text/css">
    <style type="text/css" media="screen">
    html, body{
        margin:0px;
        padding:0px;
        height:100%;
        overflow:hidden;
    }

    a.cal_link {
        font-family: Arial
    }

    div.event_gesamt {
        background-color: red;
        color: white;
    }

    div.event_bs {
        background-color: orange;
        color: white;
    }

    div.event_wallbach {
        background-color: blue;
        color: white;
    }

    div.event_rippolingen {
        background-color: green;
        color: white;
    }

    div.event_harpolingen {
        background-color: grey;
        color: white;
    }
    div.event_jugend {
        background-color: black;
        color: white;
    }

    </style>
</head>
<body>
<!--<div>-->
<!--<ul>-->
<!--<li><a class="cal_link" href="https://calendar.google.com/calendar/ical/4d4324uqu7l7cqar7egbm2767g%40group.calendar.google.com/public/basic.ics">Kalender Gesamtfeuerwehr Bad Säckingen</a></li>-->
<!--<li><a class="cal_link" href="https://calendar.google.com/calendar/ical/dmc1fi7lf8labaqos50rvp6lpg%40group.calendar.google.com/public/basic.ics">Kalender Abteilung Bad Säckingen</a></li>-->
<!--<li><a class="cal_link" href="https://calendar.google.com/calendar/ical/7d1nksapsi2mgnk7mldlgff4q0%40group.calendar.google.com/public/basic.ics">Kalender Abteilung Harpolingen</a></li>-->
<!--<li><a class="cal_link" href="https://calendar.google.com/calendar/ical/cae9hmopfnu0v0veku4g5tv9e4%40group.calendar.google.com/public/basic.ics">Kalender Abteilung Rippolingen</a></li>-->
<!--<li><a class="cal_link" href="https://calendar.google.com/calendar/ical/7804m8olrkt4arcnd019i3dtqc%40group.calendar.google.com/public/basic.ics">Kalender Abteilung Wallbach</a></li>-->
<!--</ul>-->
<!--</div>-->
<div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:100%;'>
    <div class="dhx_cal_navline">
    <div style="background:red">TODO: Legende für Farben</div>
        <div class="dhx_cal_prev_button">&nbsp;</div>
        <div class="dhx_cal_next_button">&nbsp;</div>
        <!--<div class="dhx_cal_today_button"></div>-->
        <div class="dhx_cal_date"></div>
        <!--<div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>-->
        <!--<div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>-->
        <!--<div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>-->
    </div>
    <div class="dhx_cal_header"></div>
    <div class="dhx_cal_data"></div>
</div>

<script>
if (!String.format) {
  String.format = function(format) {
    var args = Array.prototype.slice.call(arguments, 1);
    return format.replace(/{(\d+)}/g, function(match, number) {
      return typeof args[number] != 'undefined'
        ? args[number]
        : match
      ;
    });
  };
}

function removeEventPrefix(start, end, ev){
    if(ev.text.indexOf('#*') !== -1){
        return ev.text.split('#*')[1];
    }

    return ev.text;
}

function getAbteilungNameByEventText(text){
    if(text.indexOf('#*') !== -1){
        for(var key in abteilungen){
            if(abteilungen.hasOwnProperty(key) && text.startsWith(abteilungen[key])){
                return abtText[key];
            }
        }
    }

    return '';
}

function getAbteilungBadgeByEventText(text){
    if(text.indexOf('#*') !== -1){
        for(var key in abteilungen){
            if(abteilungen.hasOwnProperty(key) && text.startsWith(abteilungen[key])){
                return abtBadge[key];
            }
        }
    }

    return '';
}

var abteilungen = {};
abteilungen.gesamt = 'FWBS Gesamt';
abteilungen.bs ='FWBS Abt BS';
abteilungen.rippolingen = 'FWBS Abt Rippolingen';
abteilungen.wallbach = 'FWBS Abt Wallbach';
abteilungen.harpolingen = 'FWBS Abt. Harpolingen';
abteilungen.jugend = 'FWBS Jugend';

var abtText = {}
abtText.gesamt = 'Gesamtfeuerwehr';
abtText.bs ='Abteilung Bad Säckingen';
abtText.rippolingen = 'Abteilung Rippolingen';
abtText.wallbach = 'Abteilung Wallbach';
abtText.harpolingen = 'Abteilung Harpolingen';
abtText.jugend = 'Jugendfeuerwehr';

var abtBadge = {}
abtBadge.gesamt = 'http://helix3.fwbs.wb09.de/images/wappen_bs.png';
abtBadge.bs ='http://helix3.fwbs.wb09.de/images/wappen_bs.png';
abtBadge.rippolingen = 'http://helix3.fwbs.wb09.de/images/wappen_rippolingen.png';
abtBadge.wallbach = 'http://helix3.fwbs.wb09.de/images/wappen_wallbach.png';
abtBadge.harpolingen = 'http://helix3.fwbs.wb09.de/images/wappen_harpolingen.png';
abtBadge.jugend = 'https://upload.wikimedia.org/wikipedia/de/thumb/a/a0/Deutsche_Jugendfeuerwehr.svg/140px-Deutsche_Jugendfeuerwehr.svg.png';

scheduler.config.xml_date = "%Y-%m-%d %H:%i";
scheduler.config.prevent_cache = true;
scheduler.config.first_hour = 6;
scheduler.config.limit_time_select = true;
scheduler.locale.labels.section_location = "Location";
scheduler.config.details_on_create = false;
scheduler.config.details_on_dblclick = false;

scheduler.config.touch_tooltip = true;

scheduler.attachEvent('onDblClick', function (id, e){
    //Prevents showing details box
});

scheduler.templates.event_class = function(start, end, ev){
    for(var key in abteilungen){
        if(abteilungen.hasOwnProperty(key) && ev.text.startsWith(abteilungen[key])){
            return 'event_' + key;
        }
    }

    return '';
};

var eventTemplate = '<img src="{0}" width="20"/> <b>{1}</b>'
    + '<br/>{2}'
    + '<br/><b>Ort:</b> {3}'
    + '<br/><b>Beginn:</b> {4}:{5} Uhr'
    + '<br/><b>Ende:</b> {6}:{7} Uhr';

scheduler.templates.event_bar_text = removeEventPrefix;
scheduler.templates.event_text = removeEventPrefix;
scheduler.templates.tooltip_text = function(start,end,ev){
    return String.format(
    eventTemplate,
    getAbteilungBadgeByEventText(ev.text),
    getAbteilungNameByEventText(ev.text),
    removeEventPrefix(start, end, ev),
    ev.location,
    start.getHours(),
    start.getMinutes(),
    end.getHours(),
    end.getMinutes());
};

// Shows border of the calendar on the left side
scheduler.config.left_border = true;

scheduler.config.lightbox.sections = [
{name:"description", height:130, map_to:"text", type:"textarea" , focus:true},
{name:"location", height:43, type:"textarea", map_to:"details" },
{name:"time", height:72, type:"time", map_to:"auto"}
];

scheduler.init('scheduler_here', new Date(),"month");
scheduler.load("api/calendar/", "json");

var dp = new dataProcessor("api/calendar/");
dp.init(scheduler);

</script>
</body>
</html>